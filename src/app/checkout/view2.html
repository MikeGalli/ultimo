<div class="container">
    <div class="page-header">
        <h1>Checkout</h1>
    </div>

    <div class="row">
        <!-- checkout page -->
        <div ng-init="init()"
            class="col-xs-12 col-md-8">

            <!-- Guest checkout user credential form -->
            <div id="customerInfo"
                class="panel panel--checkout-step"
                ng-show="isGuestCheckout">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Customer info
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="accordion">

                        <div class="row">
                            <div class="col-sm-6">
                                <h3>Register or Log in</h3>
                                <div>Register with us for easy access to your order history and status:</div>
                                <br />
                                <ul>
                                    <li>
                                        <a href="/registration">Register</a>
                                    </li>
                                    <li>
                                        <a href="/login">Log In</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-sm-6">

                                <!-- Form for logged out customers; grab their name and email -->
                                <form name="customerInfo"
                                    ng-submit="next('customerInfo')"
                                    novalidate>
                                    <h3>Continue As Guest</h3>
                                    <!-- Name -->
                                    <div class="form-group">
                                        <label for="customerInputName">Name</label>
                                        <input type="text"
                                            class="form-control"
                                            id="customerInputName"
                                            name="name"
                                            ng-model="checkout.info.customer_name" />
                                    </div>
                                    <!-- Email -->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : customerInfo.email.$invalid && (subAdditionalInfo || customerInfo.email.$touched) }">
                                        <label for="customerInputEmail">Email*</label>
                                        <input type="email"
                                            class="form-control"
                                            id="customerInputEmail"
                                            name="email"
                                            ng-model="checkout.info.customer_email"
                                            required />

                                        <!-- error message -->
                                        <div class="help-block"
                                            ng-show="customerInfo.email.$invalid && (subAdditionalInfo || customerInfo.email.$touched)">
                                            <div ng-show="customerInfo.email.$error.required">This field is required.</div>
                                            <div ng-show="customerInfo.email.$error.email">This email address is not properly formatted.</div>
                                        </div>

                                    </div>
                                    <div class="text-center">
                                        <!-- next step -->
                                        <button class="next btn btn-primary btn-block-xs"
                                            type="submit">
                                            Next step
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Shipping Block -->
            <div id="shippingAddress"
                class="panel panel--checkout-step">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Ship to
                        <div class="dropdown pull-right" ng-if="!isGuestCheckout">
                            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="drop3">
                                <li role="presentation" ng-repeat="addr in addresses">
                                    <a role="menuitem" tabindex="-1" href ng-click="choiceShipping(addr.ID)">{{addr.Name}}</a>
                                </li>
                                <li role="presentation" class="divider"></li>
                                <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href ng-click="newShipping()">New</a>
                                </li>
                            </ul>
                        </div>
                    </h3>
                </div>

                <div class="panel-body"
                    style="display:none;">
                    <div class="accordion">

                        <!-- Form to add shipping addresses -->
                        <form name="shippingAddress"
                            ng-submit="next('shippingAddress')"
                            novalidate>
                            <div class="row">
                                <div class="col-sm-6">

                                    <!--First name-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.first_name.$invalid && ( subShippingAddress || shippingAddress.first_name.$touched) }">
                                        <label for="shippingInputFirstName">First Name*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="shippingInputFirstName"
                                            name="first_name"
                                            ng-model="checkout.shipping_address.first_name"
                                            required
                                            ng-disabled="checkout.shipping_address._id">

                                        <div class="help-block"
                                            ng-show="shippingAddress.first_name.$invalid && ( subShippingAddress || shippingAddress.first_name.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Last name-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.last_name.$invalid && ( subShippingAddress || shippingAddress.last_name.$touched) }">
                                        <label for="shippingInputLastName">Last Name*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="shippingInputLastName"
                                            name="last_name"
                                            required
                                            ng-model="checkout.shipping_address.last_name"
                                            ng-disabled="checkout.shipping_address._id">

                                        <div class="help-block"
                                            ng-show="shippingAddress.last_name.$invalid && ( subShippingAddress || shippingAddress.last_name.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Company-->
                                    <div class="form-group">
                                        <label for="shippingInputCompany">Company Name</label>
                                        <input type="text"
                                            class="form-control"
                                            id="shippingInputCompany"
                                            name="company"
                                            ng-model="checkout.shipping_address.company"
                                            ng-disabled="checkout.shipping_address._id">
                                    </div>

                                    <!--Address 1-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.address1.$invalid && ( subShippingAddress || shippingAddress.address1.$touched) }">
                                        <label for="shippingInputAddress">Address 1*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="shippingInputAddress"
                                            name="address1"
                                            ng-model="checkout.shipping_address.address_line1"
                                            ng-disabled="checkout.shipping_address._id"
                                            required>

                                        <div class="help-block"
                                            ng-show="shippingAddress.address1.$invalid && ( subShippingAddress || shippingAddress.address1.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Address 2-->
                                    <div class="form-group">
                                        <label for="shippingInputAddress2">Address 2</label>
                                        <input type="text"
                                            class="form-control"
                                            id="shippingInputAddress2"
                                            ng-model="checkout.shipping_address.address_line2"
                                            ng-disabled="checkout.shipping_address._id">
                                    </div>
                                </div>
                                <div class="col-sm-6">

                                    <!--Country-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.country.$invalid && ( subShippingAddress || shippingAddress.country.$touched) }">
                                        <label for="shippingAddressCity">Country*</label>

                                        <select name="country"
                                            class="form-control"
                                            ng-model="checkout.shipping_address.country"
                                            required
                                            ng-options="c.Code as c.Name for c in countries"
                                            ng-disabled="checkout.shipping_address._id">
                                        </select>

                                        <div class="help-block"
                                            ng-show="shippingAddress.country.$invalid && ( subShippingAddress || shippingAddress.country.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--City-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.city.$invalid && ( subShippingAddress || shippingAddress.city.$touched) }">
                                        <label for="shippingAddressCity">City*</label>
                                        <input type="text"
                                            id="shippingAddressCity"
                                            class="form-control"
                                            name="city"
                                            ng-model="checkout.shipping_address.city"
                                            ng-disabled="checkout.shipping_address._id"
                                            required>

                                        <div class="help-block"
                                            ng-show="shippingAddress.city.$invalid && ( subShippingAddress || shippingAddress.city.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--State-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.state.$invalid && ( subShippingAddress || shippingAddress.state.$touched) }">
                                        <label for="shippingAddressCity">
                                            {{ checkout.shipping_address.country === 'US' ? 'State*' : 'State / Province / Region *'}}
                                        </label>

                                        <!-- US: States -->
                                        <select name="state"
                                            class="form-control"
                                            required
                                            ng-model="checkout.shipping_address.state"
                                            ng-options="c.Code as c.Name for c in states"
                                            ng-disabled="checkout.shipping_address._id"
                                            ng-show="checkout.shipping_address.country === 'US'">
                                        </select>

                                        <!-- NON US: States / Regions -->
                                        <input type="text"
                                            name="state"
                                            class="form-control"
                                            required
                                            ng-model="checkout.shipping_address.state"
                                            ng-show="checkout.shipping_address.country !== 'US'">

                                        <div class="help-block"
                                            ng-show="shippingAddress.state.$invalid && ( subShippingAddress || shippingAddress.state.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Zip code-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.zip_code.$invalid && (subShippingAddress || shippingAddress.zip_code.$touched) }">
                                        <label for="shippingAddressZip">Zip / Postal Code*</label>
                                        <input type="text"
                                            id="shippingAddressZip"
                                            class="form-control"
                                            name="zip_code"
                                            ng-model="checkout.shipping_address.zip_code"
                                            ng-disabled="checkout.shipping_address._id"
                                            ot-zip-code
                                            ot-zip-code-linked-country="{{checkout.shipping_address.country}}"
                                            required>

                                        <div class="help-block"
                                            ng-show="shippingAddress.zip_code.$invalid && (subShippingAddress || shippingAddress.zip_code.$touched)">
                                            <div ng-show="shippingAddress.zip_code.$error.required">This field is required.</div>
                                            <div ng-show="shippingAddress.zip_code.$error.otZipCode">The provided zipcode is in an invalid format.</div>
                                        </div>
                                    </div>

                                    <!--Phone-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : shippingAddress.phone.$invalid && (subShippingAddress || shippingAddress.phone.$touched) }">
                                        <label for="shippingAddressPhone">Phone*</label>
                                        <input class="form-control"
                                            type="text"
                                            id="shippingAddressPhone"
                                            name="phone"
                                            ng-model="checkout.shipping_address.phone"
                                            ng-disabled="checkout.shipping_address._id"
                                            ot-telephone
                                            ot-telephone-linked-country="{{checkout.shipping_address.country}}"
                                            required>

                                        <div class="help-block"
                                            ng-show="shippingAddress.phone.$invalid && (subShippingAddress || shippingAddress.phone.$touched)">
                                            <div ng-show="shippingAddress.phone.$error.required">This field is required.</div>
                                            <div ng-show="shippingAddress.phone.$error.otTelephone">The telephone provided is in an invalid format.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- shipping notes -->
                            <div class="form-group">
                                <label for="shippingNotes">Shipping Notes</label>
                                <textarea name="notes"
                                    id="shippingNotes"
                                    class="form-control"
                                    rows="3"
                                    maxlength="256"
                                    ng-model="checkout.shipping_address.notes"></textarea>
                                <span class="help-block">
                                {{ checkout.shipping_address.notes ? checkout.shipping_address.notes.length + ' / ' : '' }}256 characters
                                </span>
                            </div>

                            <!-- use for billing -->
                            <div class="form-group">
                                <div class="checkbox">
                                    <label class="myCheckbox"
                                        for="shippingUseAsBilling">
                                        <input type="checkbox"
                                            name="shippingUseAsBilling"
                                            id="shippingUseAsBilling"
                                            ng-model="useAsBilling"> Use for billing address as well
                                    </label>
                                </div>
                            </div>

                            <!-- actions -->
                            <div class="text-center">
                                <!-- prev step -->
                                <button class="back btn btn-default btn-block-xs"
                                    ng-click="back('shippingAddress')"
                                    ng-if="isGuestCheckout"
                                    type="button">
                                    Prev step
                                </button>

                                <!-- next step -->
                                <button class="next btn btn-primary btn-block-xs"
                                    type="submit">
                                    Next step
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Billing Block -->
            <div id="billingAddress"
                class="panel panel--checkout-step">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Bill to
                        <div class="dropdown pull-right" ng-if="!isGuestCheckout">
                            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="drop3">
                                <li role="presentation" ng-repeat="addr in addresses">
                                    <a role="menuitem" tabindex="-1" ng-click="choiceBilling(addr.ID)">{{addr.Name}}</a>
                                </li>
                                <li role="presentation" class="divider"></li>
                                <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href="" ng-click="newBilling()">New</a>
                                </li>
                            </ul>
                        </div>
                    </h3>
                </div>

                <div class="panel-body"
                    style="display:none">
                    <div class="accordion">
                        <!-- Form to add billing addresses -->
                        <form name="billingAddress"
                            ng-submit="next('billingAddress')"
                            novalidate>
                            <div class="row">
                                <div class="col-sm-6">
                                    <!--First name-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.first_name.$invalid && (subBillingAddress || billingAddress.first_name.$touched) }">
                                        <label for="billingInputFirstName">First Name*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingInputFirstName"
                                            name="first_name"
                                            required
                                            ng-model="checkout.billing_address.first_name"
                                            ng-disabled="billing_address._id || useAsBilling">

                                        <div class="help-block"
                                            ng-show="billingAddress.first_name.$invalid && (subBillingAddress || billingAddress.first_name.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Last name-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.last_name.$invalid && (subBillingAddress || billingAddress.last_name.$touched) }">
                                        <label for="billingInputLastName">Last Name*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingInputLastName"
                                            name="last_name"
                                            required
                                            ng-model="checkout.billing_address.last_name"
                                            ng-disabled="billing_address._id || useAsBilling">

                                        <div class="help-block"
                                            ng-show="billingAddress.last_name.$invalid && (subBillingAddress || billingAddress.last_name.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Company-->
                                    <div class="form-group">
                                        <label for="billingInputCompany">Company Name</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingInputCompany"
                                            name="company"
                                            ng-model="checkout.billing_address.company"
                                            ng-disabled="checkout.billing_address._id || useAsBilling">
                                    </div>

                                    <!--Address 1-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.address1.$invalid && (subBillingAddress || billingAddress.address1.$touched) }">
                                        <label for="billingInputAddress">Address 1*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingInputAddress"
                                            name="address1"
                                            ng-model="checkout.billing_address.address_line1"
                                            ng-disabled="checkout.billing_address._id || useAsBilling"
                                            required>

                                        <div class="help-block"
                                            ng-show="billingAddress.address1.$invalid && (subBillingAddress || billingAddress.address1.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Address 2-->
                                    <div class="form-group">
                                        <label for="billingInputAddress2">Address 2</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingInputAddress2"
                                            ng-model="checkout.billing_address.address_line2"
                                            ng-disabled="checkout.billing_address._id || useAsBilling">
                                    </div>
                                </div>
                                <div class="col-sm-6">

                                    <!--Country-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.country.$invalid && (subBillingAddress || billingAddress.country.$touched) }">
                                        <label for="billingAddressCity">Country*</label>

                                        <select name="country"
                                            class="form-control"
                                            ng-model="checkout.billing_address.country"
                                            required
                                            ng-options="c.Code as c.Name for c in countries"
                                            ng-disabled="checkout.billing_address._id || useAsBilling">
                                        </select>

                                        <div class="help-block"
                                            ng-show="billingAddress.country.$invalid && (subBillingAddress || billingAddress.country.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--City-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.city.$invalid && (subBillingAddress || billingAddress.city.$touched) }">
                                        <label for="billingAddressCity">City*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingAddressCity"
                                            name="city"
                                            ng-model="checkout.billing_address.city"
                                            ng-disabled="checkout.billing_address._id || useAsBilling"
                                            required>

                                        <div class="help-block"
                                            ng-show="billingAddress.city.$invalid && (subBillingAddress || billingAddress.city.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--State-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.state.$invalid && (subBillingAddress || billingAddress.state.$touched) }">
                                        <label for="billingAddressCity">
                                            {{ checkout.billing_address.country === 'US' ? 'State*' : 'State / Province / Region *'}}
                                        </label>


                                        <!-- US: States -->
                                        <select name="state"
                                            class="form-control"
                                            ng-model="checkout.billing_address.state"
                                            required
                                            ng-options="c.Code as c.Name for c in states"
                                            ng-disabled="checkout.billing_address._id || useAsBilling"
                                            ng-show="checkout.billing_address.country === 'US'">
                                        </select>

                                        <!-- NON US: States / Regions -->
                                        <input type="text"
                                            name="state"
                                            class="form-control"
                                            required
                                            ng-model="checkout.billing_address.state"
                                            ng-show="checkout.billing_address.country !== 'US'">

                                        <div class="help-block"
                                            ng-show="billingAddress.state.$invalid && (subBillingAddress || billingAddress.state.$touched)">
                                            This field is required.
                                        </div>
                                    </div>

                                    <!--Zip code-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.zip_code.$invalid && (subBillingAddress || billingAddress.zip_code.$touched) }">
                                        <label for="billingAddressZip">Zip / Postal Code*</label>
                                        <input type="text"
                                            id="billingAddressZip"
                                            class="form-control"
                                            name="zip_code"
                                            ng-model="checkout.billing_address.zip_code"
                                            ng-disabled="billing_address._id || useAsBilling"
                                            ot-zip-code
                                            ot-zip-code-linked-country="{{checkout.billing_address.country}}"
                                            required>

                                        <div class="help-block"
                                            ng-show="billingAddress.zip_code.$invalid && (subBillingAddress || billingAddress.zip_code.$touched)">
                                            <div ng-show="billingAddress.zip_code.$error.required">This field is required.</div>
                                            <div ng-show="billingAddress.zip_code.$error.otZipCode">Your zipcode is in an invalid format.</div>
                                        </div>
                                    </div>

                                    <!--Phone-->
                                    <div class="form-group"
                                        ng-class="{ 'has-error' : billingAddress.phone.$invalid && (subBillingAddress || billingAddress.phone.$touched) }">
                                        <label for="billingAddressPhone">Phone*</label>
                                        <input type="text"
                                            class="form-control"
                                            id="billingAddressPhone"
                                            name="phone"
                                            ng-model="checkout.billing_address.phone"
                                            ng-disabled="checkout.billing_address._id"
                                            ot-telephone
                                            ot-telephone-linked-country="{{checkout.billing_address.country}}"
                                            required>

                                        <div class="help-block"
                                            ng-show="billingAddress.phone.$invalid && (subBillingAddress || billingAddress.phone.$touched)">
                                            <div ng-show="billingAddress.phone.$error.required">This field is required.</div>
                                            <div ng-show="billingAddress.phone.$error.otTelephone">The telephone provided is in an invalid format.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center">
                                <!-- prev step -->
                                <button class="back btn btn-default btn-block-xs"
                                    ng-click="back('billingAddress')"
                                    type="button">
                                    Prev step
                                </button>

                                <!-- next step -->
                                <button class="next btn btn-primary btn-block-xs"
                                    type="submit">
                                    Next step
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Shipping Method -->
            <div id="shippingMethod"
                class="panel panel--checkout-step">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Shipping Method
                    </h3>
                </div>
                <div class="panel-body"
                    style="display:none">
                    <div class="accordion">
                        <form novalidate>

                            <div class="radio"
                                ng-repeat="method in shippingMethods">
                                <label>
                                    <input type="radio"
                                        name="shipping_method"
                                        ng-value="method"
                                        ng-model="shippingMethod.selected"> {{method.Name}}
                                </label>
                            </div>

                            <p><small>*Additional country duties and taxes may apply for purchases outside of the United States.</small></p>

                            <div class="text-center">
                                <!-- prev step -->
                                <button class="back btn btn-default btn-block-xs"
                                    ng-click="back('shippingMethod')"
                                    type="button">
                                    Prev step
                                </button>

                                <!-- next step -->
                                <button class="next btn btn-primary btn-block-xs"
                                    ng-click="next('shippingMethod')"
                                    type="submit">
                                    Next step
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Discounts -->
            <div id="discounts"
                class="panel panel--checkout-step">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Discounts
                    </h3>
                </div>
                <div class="panel-body"
                    style="display:none">
                    <div class="accordion">
                        <gui-message-manager item="messageDiscounts"></gui-message-manager>
                        <gui-message-manager item="giftcard.message"></gui-message-manager>

                        <form ng-submit="discountApply()"
                            novalidate>
                            <div class="form-group">
                                <label for="discount">Discount Code</label>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-8">
                                        <input id="discount"
                                            type="text"
                                            class="form-control"
                                            name="discount"
                                            ng-model="discount">
                                    </div>
                                    <div class="col-xs-12 col-sm-4">
                                        <br class="visible-xs">
                                        <button type="submit"
                                            class="btn btn-primary btn-block">
                                            Apply Discount Code
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <form ng-submit="giftcard.apply()"
                            novalidate>
                            <div class="form-group">
                                <label for="giftcode">Gift Card Code</label>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-8">
                                        <input id="giftcode"
                                            type="text"
                                            class="form-control"
                                            ng-model="giftcard.code">
                                    </div>
                                    <div class="col-xs-12 col-sm-4">
                                        <br class="visible-xs">
                                        <button type="submit"
                                            class="btn btn-primary btn-block"
                                            ng-disabled="giftcard.searching">
                                            Apply Gift Card
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div class=""
                            ng-show="checkout.discounts.length">
                            Applied Discounts
                            <ul>
                                <li ng-repeat="discount in checkout.discounts">
                                    <div>
                                        {{discount.Amount | currency}} ({{discount.Code}})
                                        <!-- todo: we can't tell the difference between coupons and gift cards, so we can't neglect them properly -->
                                        <!-- <a class="" ng-click="discountNeglect(discount.Code)">
                                            <i class="fa fa-remove"></i>
                                            remove
                                        </a> -->
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="clearfix"></div>

                        <div class="text-center">
                            <!-- prev step -->
                            <button class="back btn btn-default btn-block-xs"
                                ng-click="back('discounts')">
                                Prev step
                            </button>

                            <!-- next step -->
                            <button class="next btn btn-primary btn-block-xs"
                                ng-click="next('discounts')">
                                Next step
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Method -->
            <div id="paymentMethod"
                class="panel panel--checkout-step">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Payment Method
                    </h3>
                </div>
                <div class="panel-body"
                    style="display:none">
                    <div class="accordion">

                        <div ng-repeat="method in paymentMethods">
                            <div class="radio">
                                <label>
                                    <input type="radio"
                                        name="test"
                                        ng-value="method"
                                        ng-model="paymentMethod.selected"> {{method.Name}}
                                </label>
                            </div>

                            <div class="paypal"
                                ng-show="paymentMethod.selected.Code === method.Code"
                                ng-if="method.isCreditCard">
                                <form name="method.form"
                                    novalidate
                                    class="row">

                                    <!-- REFACTOR: I don't believe we are using method.form.submited properly, and we might not even need it -->
                                    <div class="form-group col-xs-12 col-sm-4"
                                        ng-class="{ 'has-error' : (method.form.submited && method.form.type.$invalid) || (method.form.type.$invalid && !method.form.type.$pristine) }">
                                        <label>Credit Card Type</label>

                                        <select name="type"
                                            class="form-control"
                                            ng-model="method.cc.type"
                                            required
                                            ng-init="method.cc.type = creditTypes[0].Code"
                                            ng-options="c.Code as c.Name for c in creditTypes">
                                        </select>

                                        <p ng-show="(method.form.submited && method.form.type.$invalid) || (method.form.type.$invalid && !method.form.type.$pristine)"
                                            class="help-block">This field is required.</p>
                                    </div>

                                    <div class="form-group col-xs-12 col-sm-8"
                                        ng-class="{ 'has-error' : (method.form.submited && method.form.number.$invalid) || ((!method.form.number.$invalidFormat || method.form.number.$invalid) && !method.form.number.$pristine) }">

                                        <label for="paymentCardNumber">Number *</label>
                                        <input type="text"
                                            class="form-control"
                                            id="paymentCardNumber"
                                            name="number"
                                            ng-model="method.cc.number"
                                            required
                                            ng-change="validateCcNumber()">

                                        <p class="help-block"
                                            ng-show="method.form.submited && method.form.number.$error.required">This field is required.</p>

                                        <p class="help-block"
                                            ng-if="!method.form.number.$error.required"
                                            ng-show="(method.form.submited && method.form.number.$invalid) || ((!method.form.number.$invalidFormat || method.form.number.$invalid) && !method.form.number.$pristine)">
                                            Invalid number format.
                                        </p>

                                    </div>

                                    <div class="form-group col-xs-6 col-md-4"
                                        ng-class="{ 'has-error' : method.form.submited && method.form.expire_month.$invalid }">
                                        <label>Expiration <span class="hidden-xs">Month</span></label>

                                        <select class="form-control"
                                            ng-model="method.cc.expire_month"
                                            name="expire_month"
                                            required>
                                            <option value="">MM</option>
                                            <option value="1">01</option>
                                            <option value="2">02</option>
                                            <option value="3">03</option>
                                            <option value="4">04</option>
                                            <option value="5">05</option>
                                            <option value="6">06</option>
                                            <option value="7">07</option>
                                            <option value="8">08</option>
                                            <option value="9">09</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>

                                        <p ng-show="method.form.submited && method.form.expire_month.$invalid"
                                            class="help-block">This field is required.</p>
                                    </div>

                                    <div class="form-group col-xs-6 col-md-4"
                                        ng-class="{ 'has-error' : method.form.submited && method.form.expire_year.$invalid }">
                                        <label>&nbsp; <span class="hidden-xs">Year</span></label>
                                        <select class="form-control"
                                            ng-model="method.cc.expire_year"
                                            name="expire_year"
                                            required>
                                            <option value="">YY</option>
                                            <option value="2015">15</option>
                                            <option value="2016">16</option>
                                            <option value="2017">17</option>
                                            <option value="2018">18</option>
                                            <option value="2019">19</option>
                                            <option value="2020">20</option>
                                        </select>

                                        <p ng-show="method.form.submited && method.form.expire_year.$invalid"
                                            class="help-block">This field is required.</p>
                                    </div>
                                    <div class="clearfix"></div>
                                </form>
                            </div>

                        </div>

                        <div class="text-center">
                            <!-- prev step -->
                            <button class="back btn btn-default btn-block-xs"
                                ng-click="back('paymentMethod')">
                                Prev step
                            </button>

                            <!-- next step -->
                            <button class="next btn btn-primary btn-block-xs"
                                ng-click="next('paymentMethod')">
                                Next step
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- review -->
            <div id="review"
                class="panel panel--checkout-step">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Order Review
                    </h3>
                </div>
                <div class="panel-body"
                    style="display:none">
                    <div class="accordion">
                        <div class="row">
                            <div class="col-sm-6">
                                <table class="table table-bordered"
                                    ng-show="cart.getCountItems()"
                                    ng-class="{'last':$last}">
                                    <tr>
                                        <th>Product Name</th>
                                        <th>Qty</th>
                                        <th>Price</th>
                                    </tr>
                                    <tr ng-repeat="item in cart.getItems()">
                                        <td>{{item.product.name}}</td>
                                        <td>{{item.qty}}</td>
                                        <td>{{item.product.price | number: 2 | currency}}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-sm-6">
                                <table class="table table-bordered"
                                    ng-show="cart.getCountItems()"
                                    ng-class="{'last':$last}">
                                    <tr>
                                        <td>Subtotal</td>
                                        <td>{{checkout.subtotal | currency}}</td>
                                    </tr>
                                    <tr>
                                        <td>Tax</td>
                                        <td>{{checkout.tax_amount | currency}}</td>
                                    </tr>
                                    <tr>
                                        <td>Shipping</td>
                                        <td>{{checkout.shipping_amount | currency}}</td>
                                    </tr>
                                    <tr ng-if="checkout.discount_amount">
                                        <td>Discounts</td>
                                        <td>({{checkout.discount_amount | currency}})</td>
                                    </tr>
                                    <tr>
                                        <td>Total</td>
                                        <td>{{checkout.grandtotal | currency}}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="clearfix"></div>

                        <gui-message-manager item="message"></gui-message-manager>

                        <div class="text-center">
                            <!-- prev step -->
                            <button class="back btn btn-default btn-block-xs"
                                ng-click="back('review')">
                                Prev step
                            </button>

                            <!-- next step -->
                            <button class="next btn btn-primary btn-block-xs"
                                ng-click="save()">
                                Confirm purchase
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 hidden-xs hidden-sm">
            <div class="checkout">
                <!-- product row -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Order summary</h3>
                    </div>
                    <div class="panel-body">
                        <div ng-controller="cartListController">
                            <!-- if cart is empty -->
                            <h3 ng-hide="it.getCountItems()"
                                class="text-center">Cart is empty</h3>


                            <div class="product row"
                                ng-repeat="item in it.getItems()"
                                ng-show="it.getCountItems()">

                                <!-- image -->
                                <div class="col-md-4">
                                    <div class="thumbnail">
                                        <a href="{{productService.getUrl(item.pid)}}">
                                            <img ng-src="{{ item.product.image.thumb }}"
                                                err-src="placeholder.png"
                                                alt="{{item.product.name}}" />
                                        </a>
                                    </div>
                                </div>

                                <div class="col-md-8">
                                    <!-- name -->
                                    <h4>{{item.product.name}}</h4>

                                    <!-- description -->
                                    <ul class="list-unstyled"
                                        ng-if="item.hasOptions">
                                        <li ng-repeat="(key, value) in item.options">
                                            {{key}}
                                            <span ng-switch="item.product.options[key].type">
                                                <span ng-switch-when="date">{{value | date}}</span>
                                            <span ng-switch-default>{{productService.getOptStr(value)}}</span>
                                            </span>
                                        </li>
                                    </ul>

                                    <div class="row">
                                        <!-- qty -->
                                        <div class="col-xs-6">Qty:{{item.qty}}</div>

                                        <!-- price -->
                                        <div class="price text-right col-xs-6">{{item.product.price * item.qty | currency}}</div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <hr>
                        </div>
                        <div class="row cart-total"
                            ng-show="cart.getCountItems()"
                            ng-class="{'last':$last}">
                            <div class="col-xs-6">
                                <div class="cart-total__label cart-total__label--sub">Subtotal:</div>
                            </div>
                            <div class="col-xs-6">
                                <div class="cart-total__value cart-total__value--sub">{{checkout.subtotal | currency}}</div>
                            </div>

                            <div class="col-xs-6">
                                <div class="cart-total__label cart-total__label--tax">Tax:</div>
                            </div>
                            <div class="col-xs-6">
                                <div class="cart-total__value cart-total__value--tax">{{checkout.tax_amount | currency}}</div>
                            </div>

                            <div class="col-xs-6">
                                <div class="cart-total__label cart-total__label--ship">Shipping:</div>
                            </div>
                            <div class="col-xs-6">
                                <div class="cart-total__value cart-total__value--ship">{{checkout.shipping_amount | currency}}</div>
                            </div>

                            <div class="col-xs-6"
                                ng-if="checkout.discount_amount">
                                <div class="cart-total__label cart-total__label--discounts">Discounts:</div>
                            </div>
                            <div class="col-xs-6"
                                ng-if="checkout.discount_amount">
                                <div class="cart-total__value cart-total__value--discounts">({{checkout.discount_amount | currency}})</div>
                            </div>

                            <div class="col-xs-6">
                                <div class="cart-total__label cart-total__label--total">Total:</div>
                            </div>
                            <div class="col-xs-6">
                                <div class="cart-total__value cart-total__value--total">{{checkout.grandtotal | currency}}</div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-include src="getTemplate('checkout/modal/checkout-purchase-success.html')"></ng-include>
<ng-include src="getTemplate('checkout/modal/redirect.html')"></ng-include>

