language: node_js

node_js:
    - 0.12

# build image
build_image: shippableimages/ubuntu1404_nodejs
cache: true
env:
  global:
    - SLACK_ORG=Ottemo PROJECT=KariGran
    - REMOTE_HOST=kg.dev.ottemo.io FOUNDATION_URI=http://foundation.kg.dev.ottemo.io
    - secure: laOeFQrClbBzi+wA5ynMfPar7/eoRCzni5GWs9YaePm2Tizm3LwJ6EOJIdjTTvLzb12RpMjFf0bGirMzDXZoWTElBRHF5wgyHlVwBvTa9GdHAqzODVEdvrjGx6Qo24ZQAxTghQP5nu0hhQQk2SzRIP8a4xJ6/8RxSBiz/J3Fbwxu1k+lhQp3jKwTC+M2ZZOzcorWbUGCXdX/imgKbHiyP6Q0oWAeorriS+Go0RDcrfIgqZCJn6Rs1tbhc2UpSoCHWQEz/JN3wkTtdA8G2VAAh0xyoliZUp1tVTYgHXky/RWFJOw7rdrpBKZY7M47dxvsZ0a5lm4BZ51z8uByEu1Hvw==
before_install:
    # install NodeJS v0.12
    - source ~/.nvm/nvm.sh && shippable_retry nvm install $SHIPPABLE_NODE_VERSION
    - shippable_retry npm update -g npm@2.13.1
    - shippable_retry npm cache clean
    - npm version
    - shippable_retry npm install -g gulp

install:
    # install the required dependencies
    - shippable_retry npm@2.13.1 install

script:
    - NODE_ENV=production shippable_retry gulp build
    - bash deploy.sh

after_failure:
    - python slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN

after_success:
    - python slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN -s
